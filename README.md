# MoneyForward 家計分析ダッシュボード

MoneyForwardから出力したCSVファイルを分析するためのStreamlitダッシュボードアプリケーションです。

## 概要

このプロジェクトは、MoneyForwardの「収入・支出詳細」CSVファイルを統合し、インタラクティブなWebダッシュボードで家計データを分析できるツールです。

## 機能

- **データ統合**: 複数のCSVファイルを自動的に結合
- **期間別分析**: 特定の期間または全期間での収支分析
- **カテゴリ別分析**: 大項目・中項目での支出・収入の内訳表示
- **ビジュアル分析**: 
  - 円グラフによるカテゴリ別割合表示
  - 棒グラフによる中項目別金額表示
- **ドリルダウン分析**: 特定カテゴリの詳細データ表示
- **データフィルタリング**: 期間や分析対象（収入/支出）の選択

## 必要な環境

- Python 3.8以上
- uv（Pythonパッケージマネージャー）

## インストール

1. リポジトリをクローン
```bash
git clone <repository-url>
cd moneyfoward-analysis
```

2. 依存関係をインストール
```bash
uv sync
```

## データの準備

1. MoneyForwardから「収入・支出詳細」をCSV形式でエクスポート
2. エクスポートしたCSVファイルを `csv/` ディレクトリに配置

CSVファイルの命名規則: `収入・支出詳細_YYYY-MM-DD_YYYY-MM-DD.csv`

### 期待されるCSVファイル形式

CSVファイルには以下の列が含まれている必要があります：
- 計算対象
- 日付
- 内容
- 金額（円）
- 保有金融機関
- 大項目
- 中項目
- メモ
- 振替
- ID

## 使用方法

### アプリケーションの起動

```bash
./run.sh
```

または

```bash
uv run streamlit run analysis.py
```

### 基本的な使い方

1. **初回起動時**: サイドバーの「`mf_all_data.csv` を生成・更新」ボタンをクリックしてデータを統合
2. **期間選択**: サイドバーで分析したい期間を選択
3. **分析対象選択**: 「支出」または「収入」を選択
4. **カテゴリ分析**: 円グラフで表示したいカテゴリを選択
5. **ドリルダウン**: 詳細分析したい大項目を選択

### データの更新

新しいCSVファイルを追加した場合は、サイドバーの「`mf_all_data.csv` を生成・更新」ボタンをクリックしてデータを再統合してください。

## プロジェクト構造

```
moneyfoward-analysis/
├── analysis.py          # メインのStreamlitアプリケーション
├── csv/                 # MoneyForwardからエクスポートしたCSVファイル
├── pyproject.toml       # プロジェクト設定
├── run.sh              # アプリケーション起動スクリプト
├── memo.md             # 開発メモ
└── README.md           # このファイル
```

## 技術仕様

### 使用技術
- **Streamlit**: Webダッシュボードフレームワーク
- **Pandas**: データ処理・分析
- **Altair**: データ可視化

### データ処理
- CSVファイルはCP932エンコーディングで読み込み
- 計算対象=1かつ振替=0のレコードのみを分析対象とする
- 日付データは自動的にdatetime型に変換
- 金額データは数値型に変換し、無効なデータは除外

## 注意事項

- CSVファイルはCP932エンコーディング（Shift_JIS）である必要があります
- ファイル名に期間情報（YYYY-MM-DD_YYYY-MM-DD）が含まれている必要があります
- 大量のデータを扱う場合、初回のデータ統合に時間がかかる場合があります

## トラブルシューティング

### よくある問題

1. **CSVファイルが読み込めない**
   - ファイルのエンコーディングがCP932であることを確認
   - ファイル名の形式が正しいことを確認

2. **データが表示されない**
   - `csv/` ディレクトリにCSVファイルが存在することを確認
   - 「`mf_all_data.csv` を生成・更新」ボタンをクリックしてデータを再生成

3. **アプリケーションが起動しない**
   - 依存関係が正しくインストールされていることを確認
   - `uv sync` を実行して依存関係を再インストール

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。